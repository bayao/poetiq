upd: ()!()

upd[`signal] :{.r.r[x];(neg hbtt) (`.u.upd; .e.e; value flip .f.wf . value 1_.a)}

\d .r
r:{`.a.a upsert x}

\d .f
eqw:{x*1%sum x};
long:{x*x>0};
wf:{select sym, date, w:.f.eqw .f.long signal, time from x};

\d .a
a:1!flip`sym`date`signal`time!"sdin"$\:()

\d .e
e:`targetw